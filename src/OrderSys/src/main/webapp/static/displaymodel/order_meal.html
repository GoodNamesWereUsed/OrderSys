<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>订餐界面</title>
    <link rel="stylesheet" href="css/reset1.1.css"/>
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/order_meal.css"/>
</head>

<body>
<div id="order_meal" class="clearfix">
    <div class="c-left">
        <ul>
            <li class="active">
                <a href="#tuijian"><i class="icon-chevron-right"></i>推荐</a>
            </li>
            <li>
                <a href="#mifnag"><i class="icon-chevron-right"></i>米饭</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>蔬菜</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>水果水果</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>米饭</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>蔬菜</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>水果</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>米饭</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>蔬菜</a>
            </li>
            <li>
                <a href="#"><i class="icon-chevron-right"></i>水果</a>
            </li>

        </ul>
    </div>
    <!--c-left结束-->
    <div class="c-right">
        <ul class="clearfix" id="tuijian">
            <li class="food" data-id="id1">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭1</p>
                <div class="foot-bottom num">价格:￥<span class="food-price">50</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
            <li class="food" data-id="id2">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭2</p>
                <div class="foot-bottom num">价格:￥<span class="food-price">550</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
            <li class="food" data-id="id3">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭3</p>
                <div class="foot-bottom num">
                    价格:￥<span class="food-price">150</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
        </ul>
        <ul class="clearfix" id="mifnag">
            <li class="food" data-id="id1">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭5</p>
                <div class="foot-bottom num">价格:￥<span class="food-price">50</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
            <li class="food" data-id="id2">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭6</p>
                <div class="foot-bottom num">价格:￥<span class="food-price">550</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
            <li class="food" data-id="id3">
                <div class="food-img" style="background-image: url(temp/img/test.jpg);"></div>
                <p class="food-name">白饭7</p>
                <div class="foot-bottom num">
                    价格:￥<span class="food-price">150</span>
                    <input class="add" type="button" value="+"/>
                    <input type="number" value="0"/>
                    <input class="minus" type="button" value="-"/>
                </div>
            </li>
        </ul>
    </div>
    <!--c-right结束-->
    <div class="cr-bottom clearfix">
        <button class="btn-shoppCart">购物车</button>
        <div class="have_order">
            <ul>
                <!--<li  data-id = "id1">
                    <p>
                        <span class="ho-name">白饭1</span>
                        <span class="ho-momey">价格：￥<i>50</i></span>
                        <span class="num">
                            数量:
                            <input class="minus" type="button" value="-" />
                            <input type="number" value="0" />
                            <input class="add" type="button" value="+" />
                        </span>
                    </p>
                </li>-->
            </ul>
        </div>
        <span class="sum-money">总金额：￥<i>0</i></span>
        <button class="btn-settle">去结算</button>
    </div>
    <div class="mask"></div>
</div>

<script type="text/javascript" src="js/jquery1.9.min.js"></script>
<script type="text/javascript">
    /*点击左边的分类菜单*/
    $('.c-left').delegate('li', 'click', function () {
        $('.c-left').find('li').removeClass('active');
        $(this).addClass('active');
    });
    /*点击购物车和蒙版事件*/
    $('.btn-shoppCart').on('click', function () {
        $('.mask').toggle();
        $('.have_order').slideToggle();
    })
    $('.mask').on('click', function () {
        $('.btn-shoppCart').click();
    });
    /*点击购物车和蒙版事件end*/
    /*添加菜的数量*/
    /*添加到购物车里面
     *业务逻辑：根据<li class="food" data-id = "id1">的data-id去后台返回的id去添加到购物车
     * 或者在购物车里寻找id相同的修改
     *
     * */
    /*food列表*/
    var $food = $('.food'),
            $have_order = $('.have_order'); //购物车里的div,即显示已点的菜那里
    //点击添加按钮
    $food.delegate('.add', 'click', function () {
        /*修改数量*/
        var $num = $(this).siblings('input[type="number"]'),
                val = $num.val();
        /*数量*/
        val++;
        $num.val(val);
        /*根据id添加或修改购物车里的*/
        var f_id = $(this).parent().parent('.food').attr('data-id')
        /*id\价格\菜名*/
        f_price = $(this).siblings('.food-price').text(),
                f_name = $(this).parent().siblings('p.food-name').text();
        /*寻找购物车里是否有该id的菜，有则修改数量，无则添加到里面*/
        var $li = $have_order.find('li[data-id="' + f_id + '"]');
        if ($li.length == 0) { //添加
            var li_str = "<li data-id='" + f_id + "'>" +
                    "<p><span class='ho-name'>" + f_name + "</span>" +
                    "<span class='ho-momey'>价格：￥<i>" + f_price + "</i></span>" +
                    "<span class='num'>" +
                    "数量:<input class='minus' type='button' value='-' />" +
                    "<input type='number' value='" + val + "' />" +
                    "<input class='add' type='button' value='+' />" +
                    "</span></p></li>";
            $have_order.children('ul').append(li_str);
        } else { //修改
            $li.find('input[type="number"]').val(val);
        }
        setSumMoney();

    });
    /*点击删除按钮*/
    $food.delegate('.minus', 'click', function () {
        /*修改数量*/
        var $num = $(this).siblings('input[type="number"]'),
                val = $num.val();
        val--;
        if (val >= 0) {
            $num.val(val);
            /*根据id添加或修改购物车里的*/
            var f_id = $(this).parent().parent('.food').attr('data-id')
            /*id\价格\菜名*/
            f_price = $(this).siblings('.food-price').text(),
                    f_name = $(this).parent().siblings('p.food-name').text();
            /*寻找购物车里是否有该id的菜，有则修改数量，无则添加到里面*/
            var $li = $have_order.find('li[data-id="' + f_id + '"]');
            if (val == 0) { //移除
                $li.remove();
            } else { //修改
                $li.find('input[type="number"]').val(val);
            }
        }
        setSumMoney()

    });

    /*购物车里*/
    /*添加按钮*/
    $have_order.delegate('.add', 'click', function () {
        /*修改数量*/
        var $num = $(this).siblings('input[type="number"]'),
                val = $num.val();
        val++;
        $num.val(val);
        var h_id = $(this).parents('li').attr('data-id');
        /*id\价格*/
        /*寻找菜单栏，修改数量和总金额*/
        var $f_li = $food.parent().find('li[data-id="' + h_id + '"]');
        $f_li.find('input[type="number"]').val(val);
        setSumMoney();
    });
    /*删除按钮*/
    $have_order.delegate('.minus', 'click', function () {
        /*修改数量*/
        var $num = $(this).siblings('input[type="number"]'),
                val = $num.val();
        val--;
        if (val >= 0) {
            $num.val(val);
            var h_id = $(this).parents('li').attr('data-id');
            /*id\价格*/
            /*寻找菜单栏，修改数量和总金额*/
            var $f_li = $food.parent().find('li[data-id="' + h_id + '"]');
            $f_li.find('input[type="number"]').val(val);
            setSumMoney();
            if (val == 0) {
                $(this).parents('li').remove();
            }
        }

    });

    function setSumMoney() { /*修改显示的总金额*/
        var $li = $have_order.find('li'),
                num = 0;
        $li.each(function () {
            num += $(this).find('.ho-momey').children('i').text() * $(this).find('input[type="number"]').val();
        });
        $('.sum-money').children('i').text(num);
    }
    /**
     * 点击结算时，获取购物车里所有的信息到确认订单页面
     */
    $('.btn-settle').on('click', function () {
        var $have_order = $('.have_order')
        $li = $have_order.find('li');
        if ($li.length == 0) { //购物车里没有东西
            alert('购物车里是空的!请先进行点菜再结算');
        } else {
            var arr = new Array();
            /*存放购物车里的菜*/
            $li.each(function (i) {
                arr[i] = {
                    id: $(this).attr('data-id'),
                    name: $(this).find('.ho-name').text(),
                    money: $(this).find('.ho-momey i').text(),
                    num: $(this).find('input[type="number"]').val()
                }
            });

        }
        /*传递到确定订单页面*/
        console.log(arr);
    });
</script>
</body>

</html>